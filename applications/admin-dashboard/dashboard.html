<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - AtenMed</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', Arial, sans-serif; background: #f8fafc; color: #1e293b; }
        .header { background: linear-gradient(135deg, #45a7b1, #184354); color: white; padding: 1rem 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; }
        .nav { display: flex; gap: 2rem; }
        .nav a { color: white; text-decoration: none; padding: 0.5rem 1rem; border-radius: 5px; transition: background 0.3s; }
        .nav a:hover { background: rgba(255,255,255,0.1); }
        
        .main { padding: 2rem 0; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem; }
        .card { background: white; border-radius: 10px; padding: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .card h3 { color: #45a7b1; margin-bottom: 1rem; font-size: 1.2rem; }
        .stat { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #e2e8f0; }
        .stat:last-child { border-bottom: none; }
        .stat-number { font-size: 1.5rem; font-weight: bold; color: #45a7b1; }
        
        .leads-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .leads-table th, .leads-table td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #e2e8f0; }
        .leads-table th { background: #f8fafc; font-weight: 600; color: #45a7b1; }
        .leads-table tr:hover { background: #f8fafc; }
        
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.875rem; font-weight: 500; }
        .status-novo { background: #dbeafe; color: #1e40af; }
        .status-contatado { background: #fef3c7; color: #d97706; }
        .status-qualificado { background: #d1fae5; color: #059669; }
        
        .btn { padding: 0.5rem 1rem; border: none; border-radius: 5px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        .btn-primary { background: #45a7b1; color: white; }
        .btn-primary:hover { background: #3a8b94; }
        .btn-secondary { background: #e2e8f0; color: #475569; }
        .btn-secondary:hover { background: #cbd5e1; }
        
        .loading { text-align: center; padding: 2rem; color: #64748b; }
        .error { background: #fee2e2; color: #dc2626; padding: 1rem; border-radius: 5px; margin: 1rem 0; }
        .success { background: #d1fae5; color: #059669; padding: 1rem; border-radius: 5px; margin: 1rem 0; }
        
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 1rem; }
            .nav { flex-wrap: wrap; justify-content: center; }
            .dashboard-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">üè• AtenMed Dashboard</div>
                <nav class="nav">
                    <a href="#overview">Vis√£o Geral</a>
                    <a href="#leads">Leads</a>
                    <a href="#contacts">Contatos</a>
                    <a href="#settings">Configura√ß√µes</a>
                    <a href="#" onclick="logout()" style="color: #ef4444;">Sair</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <h1>Dashboard Administrativo</h1>
            <p style="color: #64748b; margin-bottom: 2rem;">Gerencie leads, contatos e monitore o desempenho da sua cl√≠nica.</p>
            
            <!-- Vis√£o Geral -->
            <section id="overview">
                <h2>üìä Vis√£o Geral</h2>
                <div class="dashboard-grid">
                    <div class="card">
                        <h3>üìà Estat√≠sticas de Leads</h3>
                        <div class="stat">
                            <span>Total de Leads</span>
                            <span class="stat-number" id="totalLeads">-</span>
                        </div>
                        <div class="stat">
                            <span>Novos (√∫ltimos 7 dias)</span>
                            <span class="stat-number" id="newLeads">-</span>
                        </div>
                        <div class="stat">
                            <span>Taxa de Convers√£o</span>
                            <span class="stat-number" id="conversionRate">-</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>üìß Contatos</h3>
                        <div class="stat">
                            <span>Total de Contatos</span>
                            <span class="stat-number" id="totalContacts">-</span>
                        </div>
                        <div class="stat">
                            <span>Pendentes</span>
                            <span class="stat-number" id="pendingContacts">-</span>
                        </div>
                        <div class="stat">
                            <span>Respondidos</span>
                            <span class="stat-number" id="answeredContacts">-</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>üéØ Performance</h3>
                        <div class="stat">
                            <span>Tempo M√©dio de Resposta</span>
                            <span class="stat-number" id="avgResponseTime">-</span>
                        </div>
                        <div class="stat">
                            <span>Leads por Especialidade</span>
                            <span class="stat-number" id="leadsBySpecialty">-</span>
                        </div>
                        <div class="stat">
                            <span>√öltima Atualiza√ß√£o</span>
                            <span class="stat-number" id="lastUpdate">-</span>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Leads Recentes -->
            <section id="leads" style="margin-top: 3rem;">
                <h2>üéØ Leads Recentes</h2>
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>√öltimos Leads</h3>
                        <button class="btn btn-primary" onclick="refreshLeads()">üîÑ Atualizar</button>
                    </div>
                    <div id="leadsContent">
                        <div class="loading">Carregando leads...</div>
                    </div>
                </div>
            </section>
            
            <!-- Contatos Recentes -->
            <section id="contacts" style="margin-top: 3rem;">
                <h2>üìß Contatos Recentes</h2>
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>√öltimos Contatos</h3>
                        <button class="btn btn-primary" onclick="refreshContacts()">üîÑ Atualizar</button>
                    </div>
                    <div id="contactsContent">
                        <div class="loading">Carregando contatos...</div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        // Verificar autentica√ß√£o
        function checkAuth() {
            const auth = localStorage.getItem('atenmed_auth');
            if (!auth) {
                window.location.href = '/login.html';
                return false;
            }
            
            try {
                const authData = JSON.parse(auth);
                const loginTime = new Date(authData.loginTime);
                const now = new Date();
                const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
                
                // Se login foi h√° mais de 24 horas, fazer logout
                if (hoursDiff >= 24) {
                    localStorage.removeItem('atenmed_auth');
                    window.location.href = '/login.html';
                    return false;
                }
                
                return true;
            } catch (error) {
                localStorage.removeItem('atenmed_auth');
                window.location.href = '/login.html';
                return false;
            }
        }
        
        // Logout
        function logout() {
            localStorage.removeItem('atenmed_auth');
            window.location.href = '/login.html';
        }
        
        // Dados mockados para demonstra√ß√£o
        const mockData = {
            leads: [
                { id: 1, nome: 'Dr. Jo√£o Silva', email: 'joao@clinica.com', telefone: '(11) 99999-9999', especialidade: 'cardiologia', status: 'novo', createdAt: '2024-01-15T10:30:00Z' },
                { id: 2, nome: 'Dra. Maria Santos', email: 'maria@clinica.com', telefone: '(11) 88888-8888', especialidade: 'dermatologia', status: 'contatado', createdAt: '2024-01-15T09:15:00Z' },
                { id: 3, nome: 'Dr. Carlos Mendes', email: 'carlos@clinica.com', telefone: '(11) 77777-7777', especialidade: 'pediatria', status: 'qualificado', createdAt: '2024-01-14T16:45:00Z' }
            ],
            contacts: [
                { id: 1, nome: 'Ana Costa', email: 'ana@email.com', assunto: 'D√∫vida sobre servi√ßos', status: 'novo', createdAt: '2024-01-15T11:20:00Z' },
                { id: 2, nome: 'Pedro Lima', email: 'pedro@email.com', assunto: 'Or√ßamento para automa√ß√£o', status: 'respondido', createdAt: '2024-01-15T08:30:00Z' }
            ]
        };

        // Carregar dados iniciais
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAuth()) return;
            
            loadDashboardData();
            loadLeads();
            loadContacts();
        });

        // Carregar dados do dashboard
        async function loadDashboardData() {
            try {
                // Simular carregamento de dados
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Atualizar estat√≠sticas
                document.getElementById('totalLeads').textContent = mockData.leads.length;
                document.getElementById('newLeads').textContent = '3';
                document.getElementById('conversionRate').textContent = '15%';
                document.getElementById('totalContacts').textContent = mockData.contacts.length;
                document.getElementById('pendingContacts').textContent = '1';
                document.getElementById('answeredContacts').textContent = '1';
                document.getElementById('avgResponseTime').textContent = '2h';
                document.getElementById('leadsBySpecialty').textContent = '3';
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('pt-BR');
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showError('Erro ao carregar dados do dashboard');
            }
        }

        // Carregar leads
        async function loadLeads() {
            try {
                const response = await fetch('/api/leads');
                const result = await response.json();
                
                if (response.ok) {
                    displayLeads(result.data || mockData.leads);
                } else {
                    displayLeads(mockData.leads);
                }
            } catch (error) {
                console.error('Erro ao carregar leads:', error);
                displayLeads(mockData.leads);
            }
        }

        // Exibir leads
        function displayLeads(leads) {
            const content = document.getElementById('leadsContent');
            
            if (leads.length === 0) {
                content.innerHTML = '<div class="loading">Nenhum lead encontrado</div>';
                return;
            }
            
            const table = `
                <table class="leads-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Especialidade</th>
                            <th>Status</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${leads.map(lead => `
                            <tr>
                                <td>${lead.nome}</td>
                                <td>${lead.email}</td>
                                <td>${lead.especialidade}</td>
                                <td><span class="status-badge status-${lead.status}">${lead.status}</span></td>
                                <td>${new Date(lead.createdAt).toLocaleDateString('pt-BR')}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            content.innerHTML = table;
        }

        // Carregar contatos
        async function loadContacts() {
            try {
                const response = await fetch('/api/contact');
                const result = await response.json();
                
                if (response.ok) {
                    displayContacts(result.data || mockData.contacts);
                } else {
                    displayContacts(mockData.contacts);
                }
            } catch (error) {
                console.error('Erro ao carregar contatos:', error);
                displayContacts(mockData.contacts);
            }
        }

        // Exibir contatos
        function displayContacts(contacts) {
            const content = document.getElementById('contactsContent');
            
            if (contacts.length === 0) {
                content.innerHTML = '<div class="loading">Nenhum contato encontrado</div>';
                return;
            }
            
            const table = `
                <table class="leads-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Assunto</th>
                            <th>Status</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${contacts.map(contact => `
                            <tr>
                                <td>${contact.nome}</td>
                                <td>${contact.email}</td>
                                <td>${contact.assunto}</td>
                                <td><span class="status-badge status-${contact.status}">${contact.status}</span></td>
                                <td>${new Date(contact.createdAt).toLocaleDateString('pt-BR')}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            content.innerHTML = table;
        }

        // Atualizar leads
        function refreshLeads() {
            document.getElementById('leadsContent').innerHTML = '<div class="loading">Atualizando leads...</div>';
            loadLeads();
        }

        // Atualizar contatos
        function refreshContacts() {
            document.getElementById('contactsContent').innerHTML = '<div class="loading">Atualizando contatos...</div>';
            loadContacts();
        }

        // Mostrar erro
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.main'));
        }

        // Mostrar sucesso
        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.querySelector('.container').insertBefore(successDiv, document.querySelector('.main'));
        }
    </script>
</body>
</html>
