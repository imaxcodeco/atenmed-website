╔═══════════════════════════════════════════════════════════════════╗
║                   CONFIGURAÇÃO DO WEBHOOK WHATSAPP                ║
║                         RESUMO EXECUTIVO                          ║
╚═══════════════════════════════════════════════════════════════════╝

┌───────────────────────────────────────────────────────────────────┐
│ 1. CONECTAR AO SERVIDOR                                           │
└───────────────────────────────────────────────────────────────────┘

ssh -i "C:\Users\Ian_1\Documents\AtenMed\site-atenmed.pem" ubuntu@3.129.206.231


┌───────────────────────────────────────────────────────────────────┐
│ 2. IR PARA O PROJETO                                              │
└───────────────────────────────────────────────────────────────────┘

cd /var/www/atenmed


┌───────────────────────────────────────────────────────────────────┐
│ 3. EXECUTAR SCRIPT (COLE TUDO)                                    │
└───────────────────────────────────────────────────────────────────┘

chmod +x scripts/setup-webhook-aws.sh && ./scripts/setup-webhook-aws.sh

Quando pedir, informe:
• Token: atenmed_webhook_secure_2024
• Phone ID: (pegue no Meta Developer)
• Token API: (pegue no Meta Developer)


┌───────────────────────────────────────────────────────────────────┐
│ 4. TESTAR                                                         │
└───────────────────────────────────────────────────────────────────┘

curl "http://localhost:3000/api/whatsapp/webhook?hub.mode=subscribe&hub.verify_token=atenmed_webhook_secure_2024&hub.challenge=OK"

✓ Deve retornar: OK


┌───────────────────────────────────────────────────────────────────┐
│ 5. CONFIGURAR NO META                                             │
└───────────────────────────────────────────────────────────────────┘

Acesse: https://developers.facebook.com/apps/

URL: https://atenmed.com.br/api/whatsapp/webhook
Token: atenmed_webhook_secure_2024

Clique em "Verificar e salvar" ✓


╔═══════════════════════════════════════════════════════════════════╗
║                      ONDE PEGAR OS TOKENS                         ║
╚═══════════════════════════════════════════════════════════════════╝

Meta Developer → WhatsApp → Configurações da API

WHATSAPP_PHONE_ID  = Phone Number ID
WHATSAPP_TOKEN     = Token de acesso (botão "Gerar Token")
WHATSAPP_VERIFY_TOKEN = atenmed_webhook_secure_2024 (você escolhe)


╔═══════════════════════════════════════════════════════════════════╗
║                     COMANDOS IMPORTANTES                          ║
╚═══════════════════════════════════════════════════════════════════╝

# Ver logs
pm2 logs atenmed

# Reiniciar servidor
pm2 restart atenmed

# Ver status
pm2 status

# Ver configuração
curl http://localhost:3000/api/whatsapp/debug-webhook

# Editar .env
nano .env


╔═══════════════════════════════════════════════════════════════════╗
║                     SOLUÇÃO DE PROBLEMAS                          ║
╚═══════════════════════════════════════════════════════════════════╝

❌ Token inválido
→ Verifique: grep WHATSAPP_VERIFY_TOKEN .env
→ O token DEVE ser IGUAL no .env e no Meta!

❌ Connection refused
→ pm2 restart atenmed

❌ SSL required
→ sudo certbot --nginx -d atenmed.com.br

❌ Webhook não responde
→ sudo systemctl status nginx
→ sudo nginx -t
→ sudo systemctl reload nginx


╔═══════════════════════════════════════════════════════════════════╗
║                    VERIFICAR SE FUNCIONOU                         ║
╚═══════════════════════════════════════════════════════════════════╝

pm2 logs atenmed

Deve mostrar:
📱 WhatsApp Business Service inicializado
✅ Webhook verificado com sucesso


╔═══════════════════════════════════════════════════════════════════╗
║                    DOCUMENTAÇÃO COMPLETA                          ║
╚═══════════════════════════════════════════════════════════════════╝

📖 WEBHOOK-SETUP.md               → Guia visual completo
📖 SOLUCAO-WEBHOOK-WHATSAPP.md    → Troubleshooting detalhado
📖 CONFIGURAR-WEBHOOK-AWS.md      → Específico para AWS
📖 COMANDO-RAPIDO-SSH.txt         → Comandos prontos

Execute:
npm run test-webhook              → Diagnóstico automático


╔═══════════════════════════════════════════════════════════════════╗
║                         DICA DE OURO                              ║
╚═══════════════════════════════════════════════════════════════════╝

⚠️  O token DEVE ser EXATAMENTE IGUAL!

No servidor:
  grep WHATSAPP_VERIFY_TOKEN .env

No Meta:
  Cole EXATAMENTE o mesmo valor

99% dos problemas são resolvidos assim! ✨


╔═══════════════════════════════════════════════════════════════════╗
║                           SUCESSO!                                ║
╚═══════════════════════════════════════════════════════════════════╝

Quando configurar e salvar no Meta, você verá nos logs:

📱 Tentativa de verificação de webhook WhatsApp
✅ Webhook verificado com sucesso

Agora o WhatsApp pode enviar mensagens para seu servidor! 🎉






