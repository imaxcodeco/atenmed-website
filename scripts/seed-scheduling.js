/**
 * Script para popular o banco de dados com dados de exemplo
 * para o sistema de Agendamento Inteligente
 * 
 * USO: node scripts/seed-scheduling.js
 */

require('dotenv').config();
const mongoose = require('mongoose');
const Clinic = require('../models/Clinic');
const Specialty = require('../models/Specialty');
const Doctor = require('../models/Doctor');

const logger = {
    info: (msg) => console.log(`‚ÑπÔ∏è  ${msg}`),
    success: (msg) => console.log(`‚úÖ ${msg}`),
    error: (msg) => console.error(`‚ùå ${msg}`),
    warn: (msg) => console.warn(`‚ö†Ô∏è  ${msg}`)
};

async function seedDatabase() {
    try {
        logger.info('Iniciando seed do banco de dados...');
        
        // Conectar ao MongoDB
        const mongoURI = process.env.MONGODB_URI || 'mongodb://localhost:27017/atenmed';
        await mongoose.connect(mongoURI);
        logger.success('Conectado ao MongoDB');
        
        // Limpar dados existentes (CUIDADO EM PRODU√á√ÉO!)
        logger.warn('Removendo dados existentes...');
        await Clinic.deleteMany({});
        await Specialty.deleteMany({});
        await Doctor.deleteMany({});
        logger.success('Dados existentes removidos');
        
        // ===== CRIAR CL√çNICAS =====
        logger.info('Criando cl√≠nicas...');
        
        const clinicCoracaoSaudavel = await Clinic.create({
            name: 'Cl√≠nica Cora√ß√£o Saud√°vel',
            description: 'Cl√≠nica especializada em cardiologia e cl√≠nica geral',
            address: {
                street: 'Av. Paulista',
                number: '1000',
                complement: 'Conjunto 501',
                neighborhood: 'Bela Vista',
                city: 'S√£o Paulo',
                state: 'SP',
                zipCode: '01310-100'
            },
            contact: {
                phone: '(11) 3000-0000',
                email: 'contato@coracaosaudavel.com.br',
                whatsapp: '(11) 99999-9999'
            },
            workingHours: { start: 8, end: 18 },
            slotDuration: 60,
            active: true,
            settings: {
                allowWeekends: false,
                autoConfirmAppointments: true,
                sendEmailNotifications: true,
                sendWhatsAppNotifications: true
            }
        });
        
        const clinicaSorrisoPerfeito = await Clinic.create({
            name: 'Cl√≠nica Sorriso Perfeito',
            description: 'Cl√≠nica odontol√≥gica completa',
            address: {
                street: 'Rua Augusta',
                number: '2500',
                neighborhood: 'Consola√ß√£o',
                city: 'S√£o Paulo',
                state: 'SP',
                zipCode: '01413-000'
            },
            contact: {
                phone: '(11) 3100-0000',
                email: 'contato@sorrisoperfeito.com.br',
                whatsapp: '(11) 98888-8888'
            },
            workingHours: { start: 9, end: 19 },
            slotDuration: 60,
            active: true
        });
        
        logger.success(`Cl√≠nicas criadas: ${clinicCoracaoSaudavel.name}, ${clinicaSorrisoPerfeito.name}`);
        
        // ===== CRIAR ESPECIALIDADES =====
        logger.info('Criando especialidades...');
        
        const cardiologia = await Specialty.create({
            name: 'Cardiologia',
            clinic: clinicCoracaoSaudavel._id,
            description: 'Especialidade m√©dica que cuida do cora√ß√£o e sistema cardiovascular',
            color: '#e74c3c',
            icon: '‚ù§Ô∏è',
            active: true,
            defaultDuration: 60,
            requiresPreparation: true,
            preparationInstructions: 'Trazer exames anteriores de cora√ß√£o (se houver). Evitar cafe√≠na 3 horas antes.'
        });
        
        const clinicaGeral = await Specialty.create({
            name: 'Cl√≠nica Geral',
            clinic: clinicCoracaoSaudavel._id,
            description: 'Atendimento m√©dico geral e preventivo',
            color: '#45a7b1',
            icon: 'üè•',
            active: true,
            defaultDuration: 45
        });
        
        const odontologia = await Specialty.create({
            name: 'Odontologia',
            clinic: clinicaSorrisoPerfeito._id,
            description: 'Cuidados com sa√∫de bucal',
            color: '#2ecc71',
            icon: 'ü¶∑',
            active: true,
            defaultDuration: 60
        });
        
        const ortodontia = await Specialty.create({
            name: 'Ortodontia',
            clinic: clinicaSorrisoPerfeito._id,
            description: 'Corre√ß√£o de posicionamento dental com aparelhos',
            color: '#3498db',
            icon: 'üòÅ',
            active: true,
            defaultDuration: 45
        });
        
        logger.success(`Especialidades criadas: ${cardiologia.name}, ${clinicaGeral.name}, ${odontologia.name}, ${ortodontia.name}`);
        
        // ===== CRIAR M√âDICOS =====
        logger.info('Criando m√©dicos...');
        
        logger.warn(`
        
‚ö†Ô∏è  IMPORTANTE: Configure os IDs dos Google Calendars!

Para cada m√©dico abaixo, voc√™ precisa:
1. Criar um calend√°rio no Google Calendar
2. Copiar o ID do calend√°rio (ex: abc123@group.calendar.google.com)
3. Substituir 'CONFIGURE_GOOGLE_CALENDAR_ID' pelo ID real

Exemplo:
googleCalendarId: 'drjoao@gmail.com' 
ou
googleCalendarId: 'abc123xyz@group.calendar.google.com'

        `);
        
        const drJoaoSilva = await Doctor.create({
            name: 'Dr. Jo√£o Silva',
            email: 'joao.silva@coracaosaudavel.com.br',
            phone: '(11) 98888-8888',
            crm: {
                number: '123456',
                state: 'SP'
            },
            specialties: [cardiologia._id],
            clinic: clinicCoracaoSaudavel._id,
            googleCalendarId: 'CONFIGURE_GOOGLE_CALENDAR_ID_DR_JOAO', // ‚ö†Ô∏è CONFIGURAR
            googleCalendarEmail: 'drjoao.calendario@gmail.com', // ‚ö†Ô∏è CONFIGURAR
            workingDays: [1, 2, 3, 4, 5], // Segunda a Sexta
            workingHours: { start: 9, end: 17 },
            slotDuration: 60,
            active: true,
            acceptsNewPatients: true,
            bio: 'Cardiologista com 15 anos de experi√™ncia. Especialista em hipertens√£o e arritmias.',
            languages: ['Portugu√™s', 'Ingl√™s'],
            notifications: {
                email: true,
                whatsapp: true
            }
        });
        
        const draMariaOliveira = await Doctor.create({
            name: 'Dra. Maria Oliveira',
            email: 'maria.oliveira@coracaosaudavel.com.br',
            phone: '(11) 97777-7777',
            crm: {
                number: '234567',
                state: 'SP'
            },
            specialties: [clinicaGeral._id],
            clinic: clinicCoracaoSaudavel._id,
            googleCalendarId: 'CONFIGURE_GOOGLE_CALENDAR_ID_DRA_MARIA', // ‚ö†Ô∏è CONFIGURAR
            googleCalendarEmail: 'dramaria.calendario@gmail.com', // ‚ö†Ô∏è CONFIGURAR
            workingDays: [1, 2, 3, 4, 5],
            workingHours: { start: 8, end: 18 },
            slotDuration: 45,
            active: true,
            acceptsNewPatients: true,
            bio: 'M√©dica generalista com foco em medicina preventiva e sa√∫de da fam√≠lia.',
            notifications: {
                email: true,
                whatsapp: true
            }
        });
        
        const drPedroSantos = await Doctor.create({
            name: 'Dr. Pedro Santos',
            email: 'pedro.santos@sorrisoperfeito.com.br',
            phone: '(11) 96666-6666',
            crm: {
                number: '345678',
                state: 'SP'
            },
            specialties: [odontologia._id, ortodontia._id],
            clinic: clinicaSorrisoPerfeito._id,
            googleCalendarId: 'CONFIGURE_GOOGLE_CALENDAR_ID_DR_PEDRO', // ‚ö†Ô∏è CONFIGURAR
            googleCalendarEmail: 'drpedro.calendario@gmail.com', // ‚ö†Ô∏è CONFIGURAR
            workingDays: [1, 2, 3, 4, 5],
            workingHours: { start: 9, end: 19 },
            slotDuration: 60,
            active: true,
            acceptsNewPatients: true,
            bio: 'Dentista com especializa√ß√£o em ortodontia. 10 anos de experi√™ncia em aparelhos ortod√¥nticos.',
            notifications: {
                email: true,
                whatsapp: false
            }
        });
        
        logger.success(`M√©dicos criados: ${drJoaoSilva.name}, ${draMariaOliveira.name}, ${drPedroSantos.name}`);
        
        // ===== RESUMO =====
        logger.success('\n‚úÖ Seed conclu√≠do com sucesso!\n');
        
        console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        console.log('üìä RESUMO DO BANCO DE DADOS');
        console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');
        
        console.log('üè¢ CL√çNICAS:');
        console.log(`   - ${clinicCoracaoSaudavel.name} (ID: ${clinicCoracaoSaudavel._id})`);
        console.log(`   - ${clinicaSorrisoPerfeito.name} (ID: ${clinicaSorrisoPerfeito._id})\n`);
        
        console.log('üè• ESPECIALIDADES:');
        console.log(`   - ${cardiologia.name} (ID: ${cardiologia._id})`);
        console.log(`   - ${clinicaGeral.name} (ID: ${clinicaGeral._id})`);
        console.log(`   - ${odontologia.name} (ID: ${odontologia._id})`);
        console.log(`   - ${ortodontia.name} (ID: ${ortodontia._id})\n`);
        
        console.log('üë®‚Äç‚öïÔ∏è M√âDICOS:');
        console.log(`   - ${drJoaoSilva.name} - ${cardiologia.name}`);
        console.log(`     ID: ${drJoaoSilva._id}`);
        console.log(`     Google Calendar: ${drJoaoSilva.googleCalendarId} ‚ö†Ô∏è  CONFIGURAR`);
        console.log('');
        console.log(`   - ${draMariaOliveira.name} - ${clinicaGeral.name}`);
        console.log(`     ID: ${draMariaOliveira._id}`);
        console.log(`     Google Calendar: ${draMariaOliveira.googleCalendarId} ‚ö†Ô∏è  CONFIGURAR`);
        console.log('');
        console.log(`   - ${drPedroSantos.name} - ${odontologia.name}, ${ortodontia.name}`);
        console.log(`     ID: ${drPedroSantos._id}`);
        console.log(`     Google Calendar: ${drPedroSantos.googleCalendarId} ‚ö†Ô∏è  CONFIGURAR\n`);
        
        console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
        console.log('‚ö†Ô∏è  PR√ìXIMOS PASSOS:');
        console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');
        console.log('1. Configure os Google Calendar IDs para cada m√©dico:');
        console.log('   - Acesse o MongoDB');
        console.log('   - Atualize o campo googleCalendarId de cada m√©dico');
        console.log('   - Exemplo: db.doctors.updateOne(');
        console.log('       { _id: ObjectId("...") },');
        console.log('       { $set: { googleCalendarId: "drjoao@gmail.com" } }');
        console.log('     )\n');
        console.log('2. Autentique o sistema com Google Calendar:');
        console.log('   - Acesse: http://localhost:3000/agendamento');
        console.log('   - V√° na aba "Google Calendar"');
        console.log('   - Clique em "Autenticar com Google"\n');
        console.log('3. Teste o agendamento:');
        console.log('   - Via API ou interface administrativa\n');
        console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');
        
    } catch (error) {
        logger.error(`Erro ao popular banco de dados: ${error.message}`);
        console.error(error);
        process.exit(1);
    } finally {
        await mongoose.disconnect();
        logger.info('Desconectado do MongoDB');
        process.exit(0);
    }
}

// Executar seed
seedDatabase();

